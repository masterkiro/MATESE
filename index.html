<!DOCTYPE html>
<html lang="id" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATESE - Material Technology and Separation Laboratory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: { lab: { 50:'#f0f9ff', 100:'#e0f2fe', 500:'#0ea5e9', 600:'#0284c7', 800:'#075985', 900:'#0c4a6e' } }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased flex flex-col min-h-screen">

    <nav class="sticky top-0 z-50 bg-white border-b border-gray-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center gap-3 cursor-pointer" onclick="switchView('public'); window.scrollTo(0,0)">
                    <div class="w-10 h-10 bg-lab-600 rounded-lg shadow-lg flex items-center justify-center text-white font-bold text-lg">M</div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900 leading-none">MATESE<span class="text-lab-600">.Lab</span></h1>
                        <p class="text-[10px] text-gray-500 font-medium uppercase tracking-wider">UPN "Veteran" Yogyakarta</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <button onclick="scrollToSection('profile-section')" class="text-sm font-medium text-gray-600 hover:text-lab-600 transition">Profil</button>
                    <button onclick="scrollToSection('gallery-section')" class="text-sm font-medium text-gray-600 hover:text-lab-600 transition">Galeri</button>
                    <button onclick="scrollToSection('publication-section')" class="text-sm font-medium text-gray-600 hover:text-lab-600 transition">Publikasi</button>
                    <div class="h-4 w-px bg-gray-300"></div>
                    <button id="nav-auth-btn" onclick="checkAuthAction()" class="px-4 py-2 text-sm font-medium bg-gray-100 text-gray-900 rounded-lg hover:bg-gray-200 transition group">
                        <i class="fa-solid fa-lock mr-2 text-gray-400 group-hover:text-gray-600"></i><span id="auth-btn-text">Login Admin</span>
                    </button>
                </div>
                <div class="md:hidden flex items-center">
                    <button onclick="toggleMobileMenu()" class="text-gray-600 hover:text-lab-600"><i class="fa-solid fa-bars text-xl"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100 absolute w-full shadow-lg">
            <div class="px-4 pt-2 pb-4 space-y-2">
                <button onclick="scrollToSection('profile-section'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700">Profil</button>
                <button onclick="scrollToSection('gallery-section'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700">Galeri</button>
                <button onclick="scrollToSection('publication-section'); toggleMobileMenu()" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-700">Publikasi</button>
                <button onclick="checkAuthAction(); toggleMobileMenu()" class="block w-full text-left px-3 py-2 text-base font-medium text-gray-600 bg-gray-50 rounded-md" id="mobile-auth-text">Login Admin</button>
            </div>
        </div>
    </nav>

    <main class="flex-grow">
        <div id="public-view" class="space-y-16 pb-16">
            <div class="relative bg-gradient-to-br from-lab-900 via-lab-800 to-lab-600 text-white overflow-hidden">
                <div class="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]"></div>
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-20 md:py-32 relative z-10 flex flex-col md:flex-row items-center gap-12">
                    <div class="w-full md:w-1/2 text-center md:text-left">
                        <span class="inline-block py-1 px-3 rounded-full bg-white/20 backdrop-blur-sm text-sm font-semibold mb-6 border border-white/30 animate-pulse">âœ¨ Material Technology and Separation</span>
                        <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">Inovasi Riset & <br/>Teknologi Material</h1>
                        <p class="text-lab-100 text-lg md:text-xl mb-8 leading-relaxed max-w-lg mx-auto md:mx-0">Wadah pengembangan diri, pengetahuan, dan keterampilan bagi mahasiswa UPN "Veteran" Yogyakarta.</p>
                        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                            <button onclick="scrollToSection('publication-section')" class="px-8 py-3 bg-white text-lab-800 rounded-full font-bold shadow-lg hover:shadow-xl hover:bg-gray-100 transition transform hover:-translate-y-1">Lihat Riset</button>
                            <button onclick="scrollToSection('profile-section')" class="px-8 py-3 bg-transparent border border-white/30 text-white rounded-full font-semibold hover:bg-white/10 transition">Pelajari Profil</button>
                        </div>
                    </div>
                    <div class="w-full md:w-1/2 flex justify-center md:justify-end">
                         <div class="relative w-full max-w-md aspect-square rounded-2xl bg-white/10 backdrop-blur-sm border border-white/20 p-4 shadow-2xl transform rotate-3 hover:rotate-0 transition duration-500">
                            <div class="w-full h-full bg-white/50 rounded-xl flex items-center justify-center text-lab-800 font-bold">MATESE LOGO</div>
                         </div>
                    </div>
                </div>
            </div>

            <section id="profile-section" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-10">
                <div class="grid md:grid-cols-2 gap-16 items-center">
                    <div>
                        <h2 class="text-lab-600 font-bold tracking-wide uppercase text-sm mb-2">Tentang Kami</h2>
                        <h3 class="text-3xl md:text-4xl font-bold text-gray-900 mb-6">Membangun Insan Unggul & Berdampak</h3>
                        <p class="text-gray-600 text-lg leading-relaxed mb-6 text-justify">
                            MATESE (Material Technology and Separation) merupakan organisasi mahasiswa yang berperan sebagai wadah pengembangan diri, pengetahuan, dan keterampilan. 
                        </p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-lab-500 transform translate-y-8 text-center"><i class="fa-solid fa-bullhorn text-3xl text-lab-500 mb-4"></i><h4 class="font-bold text-gray-900">Publikasi</h4></div>
                        <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-purple-500 text-center"><i class="fa-solid fa-graduation-cap text-3xl text-purple-500 mb-4"></i><h4 class="font-bold text-gray-900">Akademik</h4></div>
                    </div>
                </div>
            </section>

            <section id="gallery-section" class="bg-gray-100 py-16">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold text-gray-900">Galeri Kegiatan</h2>
                        <p class="text-gray-500 mt-2">Dokumentasi aktivitas riset, seminar, dan kebersamaan tim MATESE.</p>
                    </div>
                    <div id="gallery-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>
            </section>

            <section id="publication-section" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                    <div>
                        <h3 class="text-2xl font-bold text-gray-900">Publikasi Terbaru</h3>
                        <p class="text-gray-500">Daftar penelitian yang telah dipublikasikan.</p>
                    </div>
                    <div class="relative w-full md:w-auto">
                        <i class="fa-solid fa-search absolute left-3 top-3 text-gray-400"></i>
                        <input type="text" id="public-search" placeholder="Cari judul..." class="pl-10 pr-4 py-2 border border-gray-200 rounded-xl focus:ring-2 focus:ring-lab-500 outline-none w-full md:w-64 transition shadow-sm" onkeyup="renderPublicPublications()">
                    </div>
                </div>
                <div id="public-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </section>
        </div>

        <div id="admin-view" class="hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="mb-8 flex flex-col md:flex-row justify-between items-center gap-4">
                <h2 class="text-2xl font-bold">Admin Panel</h2>
                <div class="flex gap-2">
                    <button onclick="switchAdminTab('publications')" class="px-4 py-2 bg-white text-lab-700 rounded shadow text-sm font-bold">Publikasi</button>
                    <button onclick="switchAdminTab('gallery')" class="px-4 py-2 bg-white text-lab-700 rounded shadow text-sm font-bold">Galeri</button>
                    <button onclick="logout()" class="px-4 py-2 bg-red-600 text-white rounded text-sm font-bold">Logout</button>
                </div>
            </div>

            <div id="admin-publications" class="flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                        <h3 class="font-bold mb-4">Tambah Publikasi</h3>
                        <form id="publication-form" onsubmit="handlePubSubmit(event)" class="space-y-4">
                            <input type="hidden" id="pub-id">
                            <input type="text" id="pub-title" placeholder="Judul" required class="w-full px-4 py-2 border rounded">
                            <input type="text" id="pub-author" placeholder="Penulis" required class="w-full px-4 py-2 border rounded">
                            <div class="flex gap-2">
                                <input type="number" id="pub-year" placeholder="Tahun" required class="w-1/2 px-4 py-2 border rounded">
                                <select id="pub-type" class="w-1/2 px-4 py-2 border rounded">
                                    <option value="Jurnal">Jurnal</option>
                                    <option value="Prosiding">Prosiding</option>
                                    <option value="Skripsi">Skripsi</option>
                                </select>
                            </div>
                            <textarea id="pub-abstract" placeholder="Abstrak" class="w-full px-4 py-2 border rounded"></textarea>
                            <button type="submit" id="btn-submit-pub" class="w-full py-2 bg-lab-600 text-white rounded font-bold">Simpan</button>
                        </form>
                    </div>
                </div>
                <div class="w-full md:w-2/3">
                    <div class="bg-white rounded-2xl shadow border border-gray-100 overflow-hidden">
                        <table class="w-full text-sm text-left"><thead class="bg-gray-50"><tr><th class="p-4">Judul</th><th class="p-4">Aksi</th></tr></thead><tbody id="admin-table-pub" class="divide-y divide-gray-100"></tbody></table>
                    </div>
                </div>
            </div>

            <div id="admin-gallery" class="hidden flex flex-col md:flex-row gap-8">
                <div class="w-full md:w-1/3">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 sticky top-24">
                        <h3 class="font-bold mb-4">Upload Foto Baru</h3>
                        <form id="gallery-form" onsubmit="handleGallerySubmit(event)" class="space-y-4">
                            <div><label class="block text-sm font-semibold mb-1">Judul Foto</label><input type="text" id="gal-title" required class="w-full px-4 py-2 rounded border"></div>
                            <div><label class="block text-sm font-semibold mb-1">Pilih File</label><input type="file" id="gal-file" accept="image/*" required class="w-full px-4 py-2 border rounded bg-gray-50 text-sm"></div>
                            <div id="upload-loading" class="hidden text-center text-sm text-lab-600"><i class="fa-solid fa-spinner fa-spin"></i> Mengupload...</div>
                            <button type="submit" id="btn-submit-gal" class="w-full py-2 bg-purple-600 text-white rounded font-bold hover:bg-purple-700">Upload</button>
                        </form>
                    </div>
                </div>
                <div class="w-full md:w-2/3">
                    <div class="bg-white p-6 rounded-2xl shadow border border-gray-100">
                        <h3 class="font-bold mb-4">Daftar Foto Galeri</h3>
                        <div id="admin-gallery-grid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-900 text-white py-8 text-center text-sm">&copy; 2025 MATESE Laboratory.</footer>
    
    <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-xl w-full max-w-sm relative">
            <button onclick="closeLoginModal()" class="absolute top-4 right-4 text-gray-400"><i class="fa-solid fa-times"></i></button>
            <h2 class="text-xl font-bold mb-4 text-center">Login Admin</h2>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <input type="text" id="login-username" placeholder="Username" class="w-full px-4 py-2 border rounded">
                <input type="password" id="login-password" placeholder="Password" class="w-full px-4 py-2 border rounded">
                <button type="submit" class="w-full py-2 bg-lab-600 text-white rounded font-bold">Login</button>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed bottom-5 right-5 translate-y-20 opacity-0 transition-all duration-300 z-50 bg-gray-900 text-white px-6 py-3 rounded-lg shadow-2xl"><span id="toast-message">Berhasil</span></div>

    <script>
        let publications = []; let galleryItems = []; let isLoggedIn = false;
        
        // --- 1. SETTING API URL ---
        // Karena file dipisah, kita harus panggil nama filenya: 'api.php'
        const API_URL = 'api.php'; 

        async function init() {
            try {
                // Panggil ke api.php dengan timestamp agar tidak cache
                const res = await fetch(API_URL + '?action=get_data&t=' + new Date().getTime());
                const data = await res.json();
                publications = data.publications || []; galleryItems = data.gallery || []; isLoggedIn = data.is_logged_in || false;
                
                updateUIForAuth(); renderPublicPublications(); renderGallery(); renderAdminPubTable(); renderAdminGalleryGrid();
            } catch(e) { console.error(e); }
        }

        // --- AUTH & NAV ---
        function checkAuthAction() { isLoggedIn ? switchView('admin') : document.getElementById('login-modal').classList.remove('hidden'); }
        function closeLoginModal() { document.getElementById('login-modal').classList.add('hidden'); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }
        
        function switchView(view) {
            document.getElementById('public-view').classList.toggle('hidden', view === 'admin');
            document.getElementById('admin-view').classList.toggle('hidden', view !== 'admin');
            window.scrollTo(0,0);
        }

        function switchAdminTab(tab) {
            document.getElementById('admin-publications').classList.toggle('hidden', tab !== 'publications');
            document.getElementById('admin-gallery').classList.toggle('hidden', tab !== 'gallery');
        }

        function updateUIForAuth() {
            const txt = isLoggedIn ? "Admin Panel" : "Login Admin";
            document.getElementById('auth-btn-text').textContent = txt; document.getElementById('mobile-auth-text').textContent = txt;
        }

        function showToast(msg) {
            const t = document.getElementById('toast'); document.getElementById('toast-message').textContent = msg;
            t.classList.remove('translate-y-20', 'opacity-0'); setTimeout(() => t.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

        // --- LOGIN ---
        async function handleLogin(e) {
            e.preventDefault();
            const u = document.getElementById('login-username').value; const p = document.getElementById('login-password').value;
            // Fetch ke api.php
            const res = await fetch(API_URL + '?action=login', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({username:u, password:p})});
            const d = await res.json();
            if(d.status === 'success') { isLoggedIn=true; closeLoginModal(); updateUIForAuth(); switchView('admin'); showToast("Login Sukses"); } else { showToast("Login Gagal"); }
        }

        // --- LOGOUT ---
        async function logout() { 
            await fetch(API_URL + '?action=logout'); 
            isLoggedIn=false; updateUIForAuth(); switchView('public'); showToast("Logout Berhasil"); 
        }

        // --- SAVE DATA ---
        async function saveData() {
            await fetch(API_URL + '?action=save_data', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({publications, gallery:galleryItems})});
        }

        // --- UPLOAD GAMBAR ---
        async function handleGallerySubmit(e) {
            e.preventDefault();
            const title = document.getElementById('gal-title').value;
            const file = document.getElementById('gal-file').files[0];
            if(!file) return alert("Pilih file dulu!");

            document.getElementById('upload-loading').classList.remove('hidden'); document.getElementById('btn-submit-gal').disabled = true;

            try {
                const formData = new FormData(); formData.append('image', file);
                // Fetch ke api.php
                const res = await fetch(API_URL + '?action=upload_image', {method: 'POST', body: formData});
                const result = await res.json();

                if (result.status === 'success') {
                    const newId = galleryItems.length > 0 ? Math.max(...galleryItems.map(p => p.id)) + 1 : 1;
                    galleryItems.push({id: newId, title: title, url: result.url});
                    await saveData(); 
                    document.getElementById('gallery-form').reset(); renderGallery(); renderAdminGalleryGrid(); showToast("Foto berhasil diupload!");
                } else { alert("Gagal upload: " + result.message); }
            } catch (err) { console.error(err); alert("Error koneksi ke " + API_URL); } 
            finally { document.getElementById('upload-loading').classList.add('hidden'); document.getElementById('btn-submit-gal').disabled = false; }
        }

        // --- RENDER FUNCTIONS (Sama seperti sebelumnya) ---
        function renderGallery() {
            const c = document.getElementById('gallery-list'); c.innerHTML = '';
            galleryItems.forEach(item => {
                c.innerHTML += `<div class="relative group overflow-hidden rounded-xl shadow-md cursor-pointer h-64 bg-gray-200"><img src="${item.url}" class="w-full h-full object-cover transition duration-500 group-hover:scale-110"><div class="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition flex items-end p-4"><p class="text-white font-bold">${item.title}</p></div></div>`;
            });
        }
        function renderAdminGalleryGrid() {
            const c = document.getElementById('admin-gallery-grid'); c.innerHTML = '';
            galleryItems.forEach(item => {
                c.innerHTML += `<div class="relative rounded overflow-hidden h-32 group border bg-gray-100"><img src="${item.url}" class="w-full h-full object-cover"><button onclick="deleteGalleryItem(${item.id})" class="absolute top-1 right-1 bg-red-600 text-white p-1 rounded-full text-xs opacity-0 group-hover:opacity-100 transition"><i class="fa-solid fa-trash"></i></button><div class="absolute bottom-0 w-full bg-black/70 text-white text-[10px] p-1 truncate text-center">${item.title}</div></div>`;
            });
        }
        async function deleteGalleryItem(id) { if(confirm('Hapus foto?')) { galleryItems = galleryItems.filter(p => p.id !== id); await saveData(); renderGallery(); renderAdminGalleryGrid(); showToast("Foto dihapus"); } }
        function renderPublicPublications() { 
            const c = document.getElementById('public-list'); c.innerHTML = ''; const s = document.getElementById('public-search').value.toLowerCase();
            publications.filter(p=>p.title.toLowerCase().includes(s)).forEach(pub => {
                c.innerHTML += `<div class="bg-white p-6 rounded shadow border border-gray-100"><span class="text-xs font-bold bg-blue-100 text-blue-800 px-2 py-1 rounded">${pub.type}</span><h3 class="font-bold mt-2">${pub.title}</h3><p class="text-gray-500 text-sm mt-2">${pub.abstract}</p><div class="mt-4 text-sm text-gray-700 font-bold"><i class="fa-solid fa-user mr-2"></i> ${pub.author} (${pub.year})</div></div>`
            });
        }
        function renderAdminPubTable() {
            const c = document.getElementById('admin-table-pub'); c.innerHTML = '';
            publications.forEach(pub => { c.innerHTML += `<tr class="border-b"><td class="p-3 font-bold">${pub.title}</td><td class="p-3"><button onclick="deletePub(${pub.id})" class="text-red-500"><i class="fa-solid fa-trash"></i></button></td></tr>`; });
        }
        async function handlePubSubmit(e) {
            e.preventDefault(); const id = document.getElementById('pub-id').value;
            const data = { title:document.getElementById('pub-title').value, author:document.getElementById('pub-author').value, year:document.getElementById('pub-year').value, type:document.getElementById('pub-type').value, abstract:document.getElementById('pub-abstract').value };
            if(id) { publications[publications.findIndex(p=>p.id==id)] = {id:parseInt(id),...data}; } else { publications.push({id:Date.now(),...data}); }
            await saveData(); document.getElementById('publication-form').reset(); renderAdminPubTable(); renderPublicPublications(); showToast("Disimpan");
        }
        async function deletePub(id) { if(confirm('Hapus?')) { publications=publications.filter(p=>p.id!==id); await saveData(); renderAdminPubTable(); renderPublicPublications(); } }
        function scrollToSection(id) { switchView('public'); const el=document.getElementById(id); if(el) setTimeout(()=>window.scrollTo({top:el.offsetTop-80,behavior:'smooth'}),50); }

        init();
        switchView('public');
    </script>
</body>
</html>